#!/usr/bin/python
import sys
import numpy as np
from scipy import integrate
from scipy.optimize import curve_fit
import matplotlib.pyplot as plt
import locale
from mpl_toolkits.axes_grid.inset_locator import inset_axes
from matplotlib.ticker import StrMethodFormatter
from matplotlib.ticker import FormatStrFormatter
from matplotlib.font_manager import FontProperties
import os
from ctypes import *

def Soper(par):

    if (par['geometry'] == 'ice'):
        rsop = [0.03,0.05999999,0.09,0.12,0.15,0.18, 0.21,0.24,0.27,0.3,0.33 ,0.36, 0.39,0.42,0.45,0.48,0.51,0.54, 0.5699999 ,0.5999999 ,0.6299999 ,0.6599998 ,0.6899998 ,0.7199998 , 0.7499998 ,0.7799997 ,0.8099997 ,0.8399997 ,0.8699996 ,0.8999996 , 0.9299996 ,0.9599996 ,0.9899995 ,1.02      ,1.049999  ,1.079999  , 1.109999  ,1.139999  ,1.169999  ,1.199999  ,1.229999  ,1.259999  , 1.289999  ,1.319999  ,1.349999  ,1.379999  ,1.409999  ,1.439999  , 1.469999  ,1.499999  ,1.529999  ,1.559999  ,1.589999  ,1.619999  , 1.649999  ,1.679999  ,1.709999  ,1.739999  ,1.769999  ,1.799999  , 1.829999  ,1.859999  ,1.889999  ,1.919999  ,1.949999  ,1.979999  , 2.009999  ,2.039999  ,2.069999  ,2.099998  ,2.129998  ,2.159998  , 2.189998  ,2.219998  ,2.249998  ,2.279998  ,2.309998  ,2.339998  , 2.369998  ,2.399998  ,2.429998  ,2.459998  ,2.489998  ,2.519998  , 2.549998  ,2.579998  ,2.609998  ,2.639998  ,2.669998  ,2.699998  , 2.729998  ,2.759998  ,2.789998  ,2.819998  ,2.849998  ,2.879998  , 2.909998  ,2.939998  ,2.969998  ,2.999998  ,3.029998  ,3.059998  , 3.089998  ,3.119998  ,3.149997  ,3.179997  ,3.209997  ,3.239997  , 3.269997  ,3.299997  ,3.329997  ,3.359997  ,3.389997  ,3.419997  , 3.449997  ,3.479997  ,3.509997  ,3.539997  ,3.569997  ,3.599997  , 3.629997  ,3.659997  ,3.689997  ,3.719997  ,3.749997  ,3.779997  , 3.809997  ,3.839997  ,3.869997  ,3.899997  ,3.929997  ,3.959997  , 3.989997  ,4.019997  ,4.049997  ,4.079998  ,4.109998  ,4.139998  , 4.169998  ,4.199998  ,4.229999  ,4.259999  ,4.289999  ,4.319999  , 4.349999  ,4.38      ,4.41      ,4.44      ,4.47      ,4.5       , 4.530001  ,4.560001  ,4.590001  ,4.620001  ,4.650002  ,4.680002  , 4.710002  ,4.740002  ,4.770002  ,4.800003  ,4.830003  ,4.860003  , 4.890003  ,4.920003  ,4.950004  ,4.980004  ,5.010004  ,5.040004  , 5.070004  ,5.100005  ,5.130005  ,5.160005  ,5.190005  ,5.220006  , 5.250006  ,5.280006  ,5.310006  ,5.340006  ,5.370007  ,5.400007  , 5.430007  ,5.460007  ,5.490007  ,5.520008  ,5.550008  ,5.580008  , 5.610008  ,5.640008  ,5.670009  ,5.700009  ,5.730009  ,5.760009  , 5.790009  ,5.82001   ,5.85001   ,5.88001   ,5.91001   ,5.940011  , 5.970011  ,6.000011  ,6.030011  ,6.060011  ,6.090012  ,6.120012  , 6.150012  ,6.180012  ,6.210012  ,6.240013  ,6.270013  ,6.300013  , 6.330013  ,6.360013  ,6.390014  ,6.420014  ,6.450014  ,6.480014  , 6.510015  ,6.540015  ,6.570015  ,6.600015  ,6.630015  ,6.660016  , 6.690016  ,6.720016  ,6.750016  ,6.780016  ,6.810017  ,6.840017  , 6.870017  ,6.900017  ,6.930017  ,6.960018  ,6.990018  ,7.020018  , 7.050018  ,7.080019  ,7.110019  ,7.140019  ,7.170019  ,7.200019  , 7.23002   ,7.26002   ,7.29002   ,7.32002   ,7.35002   ,7.380021  , 7.410021  ,7.440021  ,7.470021  ,7.500021  ,7.530022  ,7.560022  , 7.590022  ,7.620022  ,7.650023  ,7.680023  ,7.710023  ,7.740023  , 7.770023  ,7.800024  ,7.830024  ,7.860024  ,7.890024  ,7.920024  , 7.950025  ,7.980025  ,8.010024  ,8.040024  ,8.070024  ,8.100023  , 8.130023  ,8.160023  ,8.190022  ,8.220022  ,8.250022  ,8.280022  , 8.310021,8.340021  ,8.370021  ,8.400021  ,8.43002   ,8.46002   , 8.49002   ,8.52002   ,8.550019  ,8.580019  ,8.610019  ,8.640018  , 8.670018  ,8.700018  ,8.730018  ,8.760017  ,8.790017  ,8.820017  , 8.850017  ,8.880016  ,8.910016  ,8.940016  ,8.970016  ,9.000015  , 9.030015  ,9.060015  ,9.090014  ,9.120014  ,9.150014  ,9.180014  , 9.210013  ,9.240013  ,9.270013  ,9.300013  ,9.330012  ,9.360012  , 9.390012  ,9.420012  ,9.450011  ,9.480011  ,9.510011  ,9.54001   , 9.57001   ,9.60001   ,9.63001   ,9.660009  ,9.690009  ,9.720009  , 9.750009  ,9.780008  ,9.810008  ,9.840008  ,9.870008  ,9.900007  , 9.930007  ,9.960007  ,9.990006]
        OOsop = [0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,1.283599e-05,9.372299e-05, 2.634728e-03,3.282977e-02,1.619889e-01,4.437200e-01,7.648365e-01, 9.524173e-01,9.284756e-01,8.384538e-01,7.766082e-01,7.800191e-01, 8.788853e-01,1.096414e+00,1.462282e+00,2.009637e+00,2.645347e+00, 3.277308e+00,3.692613e+00,3.759197e+00,3.456541e+00,2.899666e+00, 2.268898e+00,1.676838e+00,1.214877e+00,8.834718e-01,6.696036e-01, 5.273691e-01,4.431895e-01,3.843194e-01,3.457818e-01,3.133370e-01, 2.899470e-01,2.877818e-01,2.929237e-01,3.093311e-01,3.432391e-01, 3.879533e-01,4.442476e-01,4.954104e-01,5.367175e-01,5.585946e-01, 5.605999e-01,5.382655e-01,5.007753e-01,4.628383e-01,4.193101e-01, 3.999259e-01,3.807260e-01,3.702453e-01,3.699731e-01,3.710986e-01, 3.730550e-01,3.737127e-01,3.746114e-01,3.786698e-01,3.770775e-01, 3.897523e-01,4.125380e-01,4.491880e-01,5.087562e-01,5.904181e-01, 7.032837e-01,8.400964e-01,1.003966e+00,1.179273e+00,1.345950e+00, 1.496111e+00,1.637623e+00,1.738378e+00,1.835906e+00,1.941232e+00, 2.038966e+00,2.151447e+00,2.269632e+00,2.375657e+00,2.456555e+00, 2.497575e+00,2.462689e+00,2.367975e+00,2.221233e+00,2.030646e+00, 1.838369e+00,1.657846e+00,1.497553e+00,1.360621e+00,1.244108e+00, 1.147574e+00,1.078533e+00,1.026621e+00,9.796482e-01,9.431992e-01, 9.155605e-01,8.978629e-01,8.803276e-01,8.688230e-01,8.585647e-01, 8.533348e-01,8.473442e-01,8.498738e-01,8.534472e-01,8.656000e-01, 8.859818e-01,9.148567e-01,9.524037e-01,9.865883e-01,1.020651e+00, 1.037090e+00,1.041026e+00,1.009493e+00,9.541866e-01,8.791901e-01, 7.860200e-01,6.924016e-01,6.055991e-01,5.343902e-01,4.827959e-01, 4.474916e-01,4.286599e-01,4.310049e-01,4.429143e-01,4.701781e-01, 5.091845e-01,5.584040e-01,6.135612e-01,6.674061e-01,7.213464e-01, 7.759657e-01,8.124841e-01,8.486279e-01,8.807732e-01,9.104307e-01, 9.364368e-01,9.650090e-01,9.946705e-01,1.023640e+00,1.055893e+00, 1.087154e+00,1.107117e+00,1.128657e+00,1.139064e+00,1.143460e+00, 1.144824e+00,1.140597e+00,1.134043e+00,1.125714e+00,1.118995e+00, 1.108594e+00,1.105377e+00,1.101589e+00,1.096077e+00,1.089986e+00, 1.088853e+00,1.084619e+00,1.072668e+00,1.063289e+00,1.049839e+00, 1.027744e+00,1.003549e+00,9.729515e-01,9.409496e-01,9.075535e-01, 8.755397e-01,8.450682e-01,8.216454e-01,8.006645e-01,7.867883e-01, 7.805203e-01,7.817186e-01,7.888386e-01,8.048390e-01,8.273564e-01, 8.510988e-01,8.828374e-01,9.150518e-01,9.417814e-01,9.739481e-01, 1.003383e+00,1.028741e+00,1.048427e+00,1.067525e+00,1.080783e+00, 1.089238e+00,1.096937e+00,1.096829e+00,1.100654e+00,1.094239e+00, 1.091462e+00,1.086119e+00,1.076542e+00,1.070778e+00,1.064261e+00, 1.061761e+00,1.055906e+00,1.047198e+00,1.049162e+00,1.048402e+00, 1.047180e+00,1.050959e+00,1.053215e+00,1.061606e+00,1.067336e+00, 1.077660e+00,1.086713e+00,1.100061e+00,1.112157e+00,1.125119e+00, 1.135855e+00,1.144652e+00,1.155829e+00,1.162504e+00,1.166046e+00, 1.171595e+00,1.171729e+00,1.171554e+00,1.166971e+00,1.162510e+00, 1.152942e+00,1.146348e+00,1.133047e+00,1.121309e+00,1.108854e+00, 1.099037e+00,1.084556e+00,1.073119e+00,1.061106e+00,1.045067e+00, 1.032661e+00,1.019191e+00,1.005185e+00,9.915683e-01,9.802721e-01, 9.653086e-01,9.545279e-01,9.432460e-01,9.331250e-01,9.215223e-01, 9.152936e-01,9.072579e-01,9.004949e-01,8.940490e-01,8.916717e-01, 8.871933e-01,8.835253e-01,8.804311e-01,8.777298e-01,8.780102e-01, 8.776850e-01,8.779130e-01,8.766225e-01,8.816239e-01,8.838750e-01, 8.809934e-01,8.829466e-01,8.838915e-01,8.845302e-01,8.889614e-01, 8.917950e-01,8.941346e-01,8.968063e-01]
        OHsop= [0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 1.991497e-03,4.537012e-03,2.656524e-02,1.179437e-01,2.625780e-01, 8.045940e-01,1.843158e+00,3.750908e+00,6.288170e+00,9.273676e+00, 1.191250e+01,1.334868e+01,1.293098e+01,1.132664e+01,8.380257e+00, 5.425228e+00,2.957748e+00,1.498663e+00,6.195845e-01,2.345568e-01, 8.563325e-02,2.654093e-02,3.463197e-02,5.453141e-02,9.106231e-02, 1.402261e-01,1.882727e-01,2.438694e-01,3.041570e-01,3.885715e-01, 4.824193e-01,6.154459e-01,7.817328e-01,9.974051e-01,1.256255e+00, 1.534437e+00,1.755608e+00,1.881759e+00,1.903444e+00,1.809459e+00, 1.652216e+00,1.452802e+00,1.229293e+00,1.001910e+00,7.854679e-01, 6.003124e-01,4.481480e-01,3.347168e-01,2.507220e-01,1.963932e-01, 1.609470e-01,1.415718e-01,1.342017e-01,1.350901e-01,1.428575e-01, 1.536133e-01,1.666197e-01,1.777298e-01,1.782871e-01,1.698154e-01, 1.580038e-01,1.418168e-01,1.278095e-01,1.151397e-01,1.125105e-01, 1.157653e-01,1.291815e-01,1.511110e-01,1.848965e-01,2.319351e-01, 2.870042e-01,3.491155e-01,4.096254e-01,4.666262e-01,5.144290e-01, 5.626096e-01,6.168547e-01,6.875684e-01,7.811952e-01,9.028002e-01, 1.058831e+00,1.221668e+00,1.377135e+00,1.507939e+00,1.584898e+00, 1.607803e+00,1.585155e+00,1.539830e+00,1.474675e+00,1.411576e+00, 1.365947e+00,1.327178e+00,1.287863e+00,1.240928e+00,1.188313e+00, 1.127907e+00,1.065685e+00,1.007248e+00,9.640855e-01,9.382293e-01, 9.312699e-01,9.498842e-01,9.819634e-01,1.023263e+00,1.065987e+00, 1.084949e+00,1.078943e+00,1.053851e+00,1.000831e+00,9.369519e-01, 8.781939e-01,8.292800e-01,7.981328e-01,7.876213e-01,7.897136e-01, 8.079617e-01,8.321111e-01,8.598360e-01,8.844190e-01,9.044057e-01, 9.174055e-01,9.296446e-01,9.448985e-01,9.652773e-01,9.971806e-01, 1.040917e+00,1.095855e+00,1.163262e+00,1.226910e+00,1.292038e+00, 1.341336e+00,1.375296e+00,1.393286e+00,1.394743e+00,1.386043e+00, 1.368095e+00,1.349256e+00,1.332281e+00,1.317783e+00,1.303536e+00, 1.290014e+00,1.274363e+00,1.258995e+00,1.240533e+00,1.218135e+00, 1.197446e+00,1.172807e+00,1.150790e+00,1.130591e+00,1.108748e+00, 1.089839e+00,1.076569e+00,1.059704e+00,1.044372e+00,1.035049e+00, 1.024181e+00,1.015704e+00,1.008680e+00,1.004377e+00,1.001776e+00, 9.997605e-01,9.951835e-01,9.861749e-01,9.788861e-01,9.662291e-01, 9.521768e-01,9.420887e-01,9.299502e-01,9.193110e-01,9.131068e-01, 9.094543e-01,9.096156e-01,9.090465e-01,9.149095e-01,9.190937e-01, 9.241598e-01,9.275145e-01,9.290797e-01,9.306448e-01,9.315526e-01, 9.269543e-01,9.237260e-01,9.191226e-01,9.124045e-01,9.022280e-01, 8.931069e-01,8.833510e-01,8.716789e-01,8.601944e-01,8.481706e-01, 8.367783e-01,8.281723e-01,8.166617e-01,8.060649e-01,7.976730e-01, 7.924226e-01,7.891682e-01,7.876748e-01,7.916437e-01,7.979875e-01, 8.081339e-01,8.197415e-01,8.383217e-01,8.573936e-01,8.780110e-01, 9.005634e-01,9.221861e-01,9.435844e-01,9.616001e-01,9.776424e-01, 9.930657e-01,1.007149e+00,1.017127e+00,1.025704e+00,1.036637e+00, 1.045671e+00,1.053541e+00,1.060652e+00,1.065734e+00,1.069081e+00, 1.071093e+00,1.071755e+00,1.070196e+00,1.067625e+00,1.063942e+00, 1.058630e+00,1.053810e+00,1.051805e+00,1.050435e+00,1.045315e+00, 1.043196e+00,1.042465e+00,1.037861e+00,1.035650e+00,1.033870e+00, 1.030753e+00,1.029618e+00,1.028577e+00,1.028946e+00,1.028831e+00, 1.031030e+00,1.033499e+00,1.035250e+00,1.039133e+00,1.042470e+00, 1.046366e+00,1.048262e+00,1.051725e+00,1.052874e+00,1.054910e+00, 1.056862e+00,1.055505e+00,1.055892e+00,1.057230e+00,1.057427e+00, 1.058849e+00,1.058694e+00,1.059585e+00,1.059490e+00,1.060549e+00, 1.059160e+00,1.059194e+00,1.058142e+00,1.056637e+00,1.054550e+00, 1.052458e+00,1.051680e+00,1.050442e+00,1.047465e+00,1.045246e+00, 1.044325e+00,1.041882e+00,1.039109e+00,1.035805e+00,1.033032e+00, 1.030707e+00,1.027904e+00,1.024318e+00,1.023394e+00,1.020322e+00, 1.018426e+00,1.014392e+00,1.013049e+00,1.010415e+00,1.007192e+00, 1.004303e+00,1.001174e+00,9.985359e-01,9.960616e-01,9.917510e-01, 9.887120e-01,9.868701e-01,9.827132e-01,9.795245e-01,9.752477e-01, 9.731710e-01,9.691188e-01,9.671575e-01,9.642872e-01,9.603558e-01, 9.585036e-01,9.557024e-01,9.533771e-01,9.518282e-01,9.508763e-01, 9.484510e-01,9.473110e-01,9.463383e-01,9.443002e-01,9.429132e-01, 9.422261e-01,9.414570e-01,9.411977e-01]
        HHsop = [0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,1.075708e-03, 1.355787e-03,3.850425e-03,6.388613e-03,1.478773e-02,3.048123e-02, 5.487869e-02,1.076028e-01,1.912032e-01,3.291679e-01,5.070874e-01, 7.018002e-01,1.000808e+00,1.267813e+00,1.570539e+00,1.807827e+00, 1.877220e+00,1.778436e+00,1.705182e+00,1.508067e+00,1.202549e+00, 8.950119e-01,6.288386e-01,4.281291e-01,2.711510e-01,1.821915e-01, 1.515126e-01,1.728211e-01,2.350375e-01,3.195928e-01,4.023699e-01, 4.871348e-01,5.762590e-01,6.770580e-01,7.994387e-01,9.506950e-01, 1.133904e+00,1.339919e+00,1.536470e+00,1.704778e+00,1.819587e+00, 1.869226e+00,1.858432e+00,1.803192e+00,1.725590e+00,1.643787e+00, 1.554560e+00,1.469214e+00,1.377075e+00,1.277382e+00,1.167316e+00, 1.044550e+00,9.182157e-01,7.951844e-01,6.838289e-01,5.877635e-01, 5.085670e-01,4.462113e-01,4.039407e-01,3.714206e-01,3.549123e-01, 3.436038e-01,3.403575e-01,3.432034e-01,3.465188e-01,3.560207e-01, 3.717606e-01,3.922404e-01,4.219661e-01,4.588208e-01,5.042954e-01, 5.528486e-01,5.965677e-01,6.368505e-01,6.624888e-01,6.811708e-01, 6.901519e-01,6.926802e-01,7.012894e-01,7.153597e-01,7.445967e-01, 7.873550e-01,8.446664e-01,9.111634e-01,9.826556e-01,1.046980e+00, 1.099359e+00,1.132952e+00,1.150595e+00,1.156710e+00,1.161476e+00, 1.168499e+00,1.191629e+00,1.224300e+00,1.261753e+00,1.306678e+00, 1.339662e+00,1.354806e+00,1.346813e+00,1.320236e+00,1.276718e+00, 1.227957e+00,1.183510e+00,1.157000e+00,1.147777e+00,1.157615e+00, 1.185333e+00,1.227607e+00,1.272907e+00,1.313322e+00,1.339301e+00, 1.345894e+00,1.332032e+00,1.298237e+00,1.258368e+00,1.215067e+00, 1.172420e+00,1.136714e+00,1.107310e+00,1.086165e+00,1.067727e+00, 1.051582e+00,1.034210e+00,1.014797e+00,9.892702e-01,9.661890e-01, 9.403634e-01,9.195898e-01,8.999457e-01,8.867661e-01,8.817756e-01, 8.796726e-01,8.863081e-01,8.970841e-01,9.154518e-01,9.356484e-01, 9.562868e-01,9.786496e-01,1.001974e+00,1.021609e+00,1.036023e+00, 1.047002e+00,1.049543e+00,1.050488e+00,1.045781e+00,1.039368e+00, 1.034166e+00,1.030655e+00,1.031915e+00,1.035552e+00,1.046589e+00, 1.061419e+00,1.077961e+00,1.096053e+00,1.111033e+00,1.121411e+00, 1.124459e+00,1.120473e+00,1.109956e+00,1.089942e+00,1.068040e+00, 1.040876e+00,1.015650e+00,9.923769e-01,9.705636e-01,9.511055e-01, 9.379506e-01,9.277009e-01,9.195883e-01,9.131280e-01,9.084321e-01, 9.038041e-01,9.008133e-01,8.973240e-01,8.943164e-01,8.906997e-01, 8.899019e-01,8.890379e-01,8.872843e-01,8.867149e-01,8.848827e-01, 8.855115e-01,8.852348e-01,8.838460e-01,8.836884e-01,8.824206e-01, 8.792108e-01,8.772432e-01,8.728976e-01,8.712282e-01,8.676508e-01, 8.681198e-01,8.664851e-01,8.701220e-01,8.754744e-01,8.821220e-01, 8.911841e-01,9.028428e-01,9.168740e-01,9.299412e-01,9.452986e-01, 9.597663e-01,9.749179e-01,9.888441e-01,1.001462e+00,1.010065e+00, 1.018587e+00,1.025293e+00,1.030613e+00,1.033342e+00,1.034416e+00, 1.037431e+00,1.038665e+00,1.040573e+00,1.040924e+00,1.045043e+00, 1.047861e+00,1.052698e+00,1.057006e+00,1.060217e+00,1.064723e+00, 1.067577e+00,1.071046e+00,1.072323e+00,1.073821e+00,1.072863e+00, 1.070546e+00,1.068548e+00,1.065565e+00,1.061965e+00,1.057218e+00, 1.053702e+00,1.050616e+00,1.046775e+00,1.044506e+00,1.042900e+00, 1.040881e+00,1.039775e+00,1.040819e+00,1.040940e+00,1.039328e+00, 1.040048e+00,1.039209e+00,1.039858e+00,1.039537e+00,1.039147e+00, 1.039203e+00,1.040168e+00,1.039566e+00,1.038961e+00,1.038044e+00, 1.039258e+00,1.036870e+00,1.036352e+00,1.034466e+00,1.031739e+00, 1.030643e+00,1.026994e+00,1.024477e+00,1.021285e+00,1.019571e+00, 1.017399e+00,1.014869e+00,1.012355e+00,1.010668e+00,1.008295e+00, 1.006756e+00,1.005397e+00,1.002873e+00,1.001916e+00,9.999045e-01, 9.987615e-01,9.966350e-01,9.957947e-01,9.946588e-01,9.929539e-01, 9.908555e-01,9.882951e-01,9.873671e-01,9.851255e-01,9.849881e-01, 9.811210e-01,9.795924e-01,9.780493e-01,9.771212e-01,9.747937e-01, 9.740072e-01,9.717547e-01,9.694391e-01,9.685081e-01,9.672295e-01, 9.663927e-01,9.649417e-01,9.642163e-01,9.634594e-01,9.634029e-01, 9.644008e-01,9.635272e-01,9.638582e-01]

    if (par['geometry'] == 'water'):
        rsop = [0.03      ,0.05999999,0.09      ,0.12      ,0.15      ,0.18      , 0.21      ,0.24      ,0.27      ,0.3       ,0.33      ,0.36      , 0.39      ,0.42      ,0.45      ,0.48      ,0.51      ,0.54      , 0.5699999 ,0.5999999 ,0.6299999 ,0.6599998 ,0.6899998 ,0.7199998 , 0.7499998 ,0.7799997 ,0.8099997 ,0.8399997 ,0.8699996 ,0.8999996 , 0.9299996 ,0.9599996 ,0.9899995 ,1.02      ,1.049999  ,1.079999  , 1.109999  ,1.139999  ,1.169999  ,1.199999  ,1.229999  ,1.259999  , 1.289999  ,1.319999  ,1.349999  ,1.379999  ,1.409999  ,1.439999  , 1.469999  ,1.499999  ,1.529999  ,1.559999  ,1.589999  ,1.619999  , 1.649999  ,1.679999  ,1.709999  ,1.739999  ,1.769999  ,1.799999  , 1.829999  ,1.859999  ,1.889999  ,1.919999  ,1.949999  ,1.979999  ,2.009999  ,2.039999  ,2.069999  ,2.099998  ,2.129998  ,2.159998  , 2.189998  ,2.219998  ,2.249998  ,2.279998  ,2.309998  ,2.339998  , 2.369998  ,2.399998  ,2.429998  ,2.459998  ,2.489998  ,2.519998  , 2.549998  ,2.579998  ,2.609998  ,2.639998  ,2.669998  ,2.699998  , 2.729998  ,2.759998  ,2.789998  ,2.819998  ,2.849998  ,2.879998  , 2.909998  ,2.939998  ,2.969998  ,2.999998  ,3.029998  ,3.059998  , 3.089998  ,3.119998  ,3.149997  ,3.179997  ,3.209997  ,3.239997  , 3.269997  ,3.299997  ,3.329997  ,3.359997  ,3.389997  ,3.419997  , 3.449997  ,3.479997  ,3.509997  ,3.539997  ,3.569997  ,3.599997  , 3.629997  ,3.659997  ,3.689997  ,3.719997  ,3.749997  ,3.779997  , 3.809997  ,3.839997  ,3.869997  ,3.899997  ,3.929997  ,3.959997  , 3.989997  ,4.019997  ,4.049997  ,4.079998  ,4.109998  ,4.139998  , 4.169998  ,4.199998  ,4.229999  ,4.259999  ,4.289999  ,4.319999  , 4.349999  ,4.38      ,4.41      ,4.44      ,4.47      ,4.5       , 4.530001  ,4.560001  ,4.590001  ,4.620001  ,4.650002  ,4.680002  , 4.710002  ,4.740002  ,4.770002  ,4.800003  ,4.830003  ,4.860003  , 4.890003  ,4.920003  ,4.950004  ,4.980004  ,5.010004  ,5.040004  , 5.070004  ,5.100005  ,5.130005  ,5.160005  ,5.190005  ,5.220006  , 5.250006  ,5.280006  ,5.310006  ,5.340006  ,5.370007  ,5.400007  , 5.430007  ,5.460007  ,5.490007  ,5.520008  ,5.550008  ,5.580008  , 5.610008  ,5.640008  ,5.670009  ,5.700009  ,5.730009  ,5.760009  , 5.790009  ,5.82001   ,5.85001   ,5.88001   ,5.91001   ,5.940011  , 5.970011  ,6.000011  ,6.030011  ,6.060011  ,6.090012  ,6.120012  , 6.150012  ,6.180012  ,6.210012  ,6.240013  ,6.270013  ,6.300013  , 6.330013  ,6.360013  ,6.390014  ,6.420014  ,6.450014  ,6.480014  , 6.510015  ,6.540015  ,6.570015  ,6.600015  ,6.630015  ,6.660016  , 6.690016  ,6.720016  ,6.750016  ,6.780016  ,6.810017  ,6.840017  , 6.870017  ,6.900017  ,6.930017  ,6.960018  ,6.990018  ,7.020018  , 7.050018  ,7.080019  ,7.110019  ,7.140019  ,7.170019  ,7.200019  , 7.23002   ,7.26002   ,7.29002   ,7.32002   ,7.35002   ,7.380021  , 7.410021  ,7.440021  ,7.470021  ,7.500021  ,7.530022  ,7.560022  , 7.590022  ,7.620022  ,7.650023  ,7.680023  ,7.710023  ,7.740023  , 7.770023  ,7.800024  ,7.830024  ,7.860024  ,7.890024  ,7.920024  , 7.950025  ,7.980025  ,8.010024  ,8.040024  ,8.070024  ,8.100023  , 8.130023  ,8.160023  ,8.190022  ,8.220022  ,8.250022  ,8.280022  , 8.310021  ,8.340021  ,8.370021  ,8.400021  ,8.43002   ,8.46002   , 8.49002   ,8.52002   ,8.550019  ,8.580019  ,8.610019  ,8.640018  , 8.670018  ,8.700018  ,8.730018  ,8.760017  ,8.790017  ,8.820017  , 8.850017  ,8.880016  ,8.910016  ,8.940016  ,8.970016  ,9.000015  , 9.030015  ,9.060015  ,9.090014  ,9.120014  ,9.150014  ,9.180014  , 9.210013  ,9.240013  ,9.270013  ,9.300013  ,9.330012  ,9.360012  , 9.390012  ,9.420012  ,9.450011  ,9.480011  ,9.510011  ,9.54001   , 9.57001   ,9.60001   ,9.63001   ,9.660009  ,9.690009  ,9.720009  , 9.750009  ,9.780008  ,9.810008  ,9.840008  ,9.870008  ,9.900007  , 9.930007  ,9.960007  ,9.990006]

        OOsop = [0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,3.679304e-05, 4.442665e-04,1.423973e-03,4.591633e-03,1.043060e-02,2.320772e-02, 5.321758e-02,1.152606e-01,2.467504e-01,4.515013e-01,7.778286e-01, 1.177966e+00,1.635739e+00,2.078398e+00,2.444141e+00,2.660500e+00, 2.750478e+00,2.741458e+00,2.620422e+00,2.437901e+00,2.234889e+00, 2.008149e+00,1.797941e+00,1.605115e+00,1.439321e+00,1.294060e+00, 1.188888e+00,1.086614e+00,1.016223e+00,9.471452e-01,9.015113e-01, 8.616711e-01,8.403011e-01,8.191254e-01,8.073213e-01,7.942226e-01, 7.836796e-01,7.800003e-01,7.874304e-01,7.879868e-01,7.902403e-01, 7.979103e-01,7.992695e-01,8.073941e-01,8.210387e-01,8.286147e-01, 8.449718e-01,8.517148e-01,8.747811e-01,8.910520e-01,9.066138e-01, 9.170968e-01,9.353535e-01,9.548444e-01,9.761706e-01,9.892080e-01, 1.003233e+00,1.021954e+00,1.025584e+00,1.034068e+00,1.055291e+00, 1.066937e+00,1.072347e+00,1.084788e+00,1.085427e+00,1.100055e+00, 1.103062e+00,1.114598e+00,1.126783e+00,1.127537e+00,1.134589e+00, 1.140263e+00,1.151283e+00,1.151908e+00,1.154902e+00,1.160721e+00, 1.160673e+00,1.153215e+00,1.157929e+00,1.151650e+00,1.143771e+00, 1.139757e+00,1.131490e+00,1.116257e+00,1.109652e+00,1.096387e+00, 1.084768e+00,1.071471e+00,1.057181e+00,1.045705e+00,1.032087e+00, 1.019307e+00,1.002530e+00,9.872173e-01,9.773894e-01,9.638448e-01, 9.535507e-01,9.381640e-01,9.295661e-01,9.196875e-01,9.138566e-01, 9.084564e-01,8.996010e-01,8.936439e-01,8.887704e-01,8.836660e-01, 8.827149e-01,8.795737e-01,8.834169e-01,8.810109e-01,8.789060e-01, 8.772315e-01,8.827453e-01,8.824743e-01,8.862094e-01,8.917826e-01, 8.976791e-01,9.026673e-01,9.073505e-01,9.130673e-01,9.209640e-01, 9.290558e-01,9.331741e-01,9.387136e-01,9.512350e-01,9.558408e-01, 9.609219e-01,9.636700e-01,9.708414e-01,9.803780e-01,9.879083e-01, 9.892616e-01,9.994189e-01,1.004968e+00,1.011831e+00,1.016150e+00, 1.022682e+00,1.025996e+00,1.028574e+00,1.033839e+00,1.039039e+00, 1.043233e+00,1.044240e+00,1.050630e+00,1.050528e+00,1.050625e+00, 1.051717e+00,1.057765e+00,1.057092e+00,1.058475e+00,1.059406e+00, 1.061289e+00,1.058694e+00,1.058682e+00,1.059088e+00,1.057881e+00, 1.055893e+00,1.055734e+00,1.057651e+00,1.052750e+00,1.048192e+00, 1.043267e+00,1.042491e+00,1.038092e+00,1.036644e+00,1.032196e+00, 1.029268e+00,1.025189e+00,1.020222e+00,1.018023e+00,1.013832e+00, 1.009232e+00,1.008945e+00,1.005368e+00,9.982556e-01,9.973147e-01, 9.926816e-01,9.892640e-01,9.856818e-01,9.825418e-01,9.806194e-01, 9.793572e-01,9.751740e-01,9.784985e-01,9.758866e-01,9.717006e-01, 9.720550e-01,9.714724e-01,9.704607e-01,9.702045e-01,9.709283e-01, 9.730079e-01,9.730635e-01,9.747310e-01,9.762729e-01,9.776741e-01, 9.764012e-01,9.790957e-01,9.813725e-01,9.839786e-01,9.857554e-01, 9.863810e-01,9.867296e-01,9.899862e-01,9.897984e-01,9.930689e-01, 9.923584e-01,9.951777e-01,9.938986e-01,9.965270e-01,9.990824e-01, 9.992037e-01,9.978844e-01,9.995075e-01,9.991942e-01,1.001070e+00, 1.000000e+00,9.998036e-01,9.989501e-01,1.001059e+00,9.998525e-01, 9.991792e-01,9.985895e-01,1.000785e+00,1.003029e+00,1.001644e+00, 1.000288e+00,1.000168e+00,1.001215e+00,1.003141e+00,1.003159e+00, 1.003395e+00,1.001655e+00,1.002577e+00,1.003379e+00,1.001941e+00, 1.006279e+00,1.003079e+00,1.004206e+00,1.004860e+00,1.004074e+00, 1.001807e+00,1.002746e+00,1.001901e+00,1.002837e+00,1.004624e+00, 1.002691e+00,1.003590e+00,1.003480e+00,1.002195e+00,1.003485e+00, 1.002246e+00,1.000576e+00,1.003964e+00,1.001624e+00,1.001180e+00, 1.002708e+00,1.003867e+00,1.004679e+00]
        
        OHsop = [0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 1.172571e-03,1.068312e-03,1.564205e-02,1.050508e-01,2.888716e-01, 7.294023e-01,1.769986e+00,3.411961e+00,5.897429e+00,8.501945e+00, 1.098590e+01,1.271100e+01,1.231697e+01,9.879551e+00,7.798346e+00, 4.753154e+00,2.593265e+00,1.326995e+00,5.485278e-01,2.318772e-01, 9.402054e-02,5.021453e-02,4.006793e-02,5.101620e-02,6.960036e-02, 9.752281e-02,1.389900e-01,1.858026e-01,2.526437e-01,3.312488e-01, 4.246034e-01,5.371223e-01,6.505920e-01,7.556455e-01,8.706505e-01, 9.599361e-01,1.039073e+00,1.100997e+00,1.118153e+00,1.115516e+00, 1.086554e+00,1.042658e+00,9.824927e-01,9.070236e-01,8.282252e-01, 7.525793e-01,6.770750e-01,6.113874e-01,5.428862e-01,4.851168e-01, 4.333377e-01,3.888243e-01,3.502051e-01,3.166173e-01,2.898999e-01, 2.667103e-01,2.488342e-01,2.354217e-01,2.251970e-01,2.204044e-01, 2.205955e-01,2.234359e-01,2.297769e-01,2.430895e-01,2.606689e-01, 2.813656e-01,3.063256e-01,3.365785e-01,3.724194e-01,4.153814e-01, 4.584872e-01,5.076469e-01,5.619103e-01,6.212986e-01,6.847391e-01, 7.525042e-01,8.231595e-01,8.959921e-01,9.737229e-01,1.044168e+00, 1.122808e+00,1.193839e+00,1.265150e+00,1.327802e+00,1.382599e+00, 1.429158e+00,1.464187e+00,1.493589e+00,1.507307e+00,1.512905e+00, 1.514091e+00,1.502396e+00,1.476402e+00,1.450364e+00,1.421106e+00, 1.388573e+00,1.351932e+00,1.319936e+00,1.282395e+00,1.248962e+00, 1.217071e+00,1.182164e+00,1.158338e+00,1.135499e+00,1.110295e+00, 1.090872e+00,1.071484e+00,1.059286e+00,1.044629e+00,1.030895e+00, 1.025304e+00,1.017001e+00,1.008714e+00,1.008830e+00,9.999038e-01, 9.946317e-01,9.922935e-01,9.886937e-01,9.886519e-01,9.816748e-01, 9.813739e-01,9.782985e-01,9.764175e-01,9.739811e-01,9.728835e-01, 9.702784e-01,9.663368e-01,9.689949e-01,9.665960e-01,9.645776e-01, 9.628170e-01,9.626991e-01,9.600238e-01,9.601253e-01,9.606105e-01, 9.599030e-01,9.615597e-01,9.614902e-01,9.633877e-01,9.638413e-01, 9.666810e-01,9.688212e-01,9.709472e-01,9.718258e-01,9.741936e-01, 9.781371e-01,9.809241e-01,9.816260e-01,9.825763e-01,9.869361e-01, 9.869553e-01,9.885221e-01,9.917524e-01,9.923909e-01,9.933715e-01, 9.943268e-01,9.940827e-01,9.950622e-01,9.942345e-01,9.957180e-01, 9.949041e-01,9.941904e-01,9.940252e-01,9.910007e-01,9.916692e-01, 9.924330e-01,9.907742e-01,9.898409e-01,9.896472e-01,9.881582e-01, 9.894214e-01,9.869801e-01,9.860978e-01,9.860447e-01,9.841276e-01, 9.852687e-01,9.847820e-01,9.821514e-01,9.841334e-01,9.839352e-01, 9.820192e-01,9.804544e-01,9.827074e-01,9.834236e-01,9.832313e-01, 9.826680e-01,9.821487e-01,9.818724e-01,9.844670e-01,9.854634e-01, 9.856257e-01,9.877070e-01,9.880646e-01,9.904132e-01,9.912331e-01, 9.942166e-01,9.947220e-01,9.969131e-01,9.964589e-01,9.994643e-01, 1.001202e+00,1.002324e+00,1.005312e+00,1.006382e+00,1.007465e+00, 1.008395e+00,1.011125e+00,1.012156e+00,1.012966e+00,1.015342e+00, 1.016934e+00,1.017906e+00,1.017573e+00,1.020107e+00,1.018690e+00, 1.019893e+00,1.018513e+00,1.019288e+00,1.019751e+00,1.019502e+00, 1.019743e+00,1.021246e+00,1.019829e+00,1.018096e+00,1.017582e+00, 1.017571e+00,1.017297e+00,1.018250e+00,1.015450e+00,1.016254e+00, 1.015553e+00,1.013945e+00,1.012861e+00,1.011510e+00,1.010484e+00, 1.009496e+00,1.008863e+00,1.007017e+00,1.005073e+00,1.005030e+00, 1.003011e+00,1.001287e+00,9.995860e-01,9.983325e-01,9.979509e-01, 9.965994e-01,9.946964e-01,9.940214e-01,9.937801e-01,9.930223e-01, 9.910317e-01,9.909296e-01,9.909258e-01,9.902164e-01,9.891793e-01, 9.886398e-01,9.886256e-01,9.882094e-01,9.886018e-01,9.878677e-01, 9.879945e-01,9.883150e-01,9.876399e-01,9.887956e-01,9.889432e-01, 9.888853e-01,9.890791e-01,9.891782e-01,9.903024e-01,9.906271e-01, 9.896769e-01,9.918118e-01,9.928353e-01,9.922991e-01,9.929108e-01, 9.951417e-01,9.950208e-01,9.955956e-01,9.961050e-01,9.968708e-01, 9.965332e-01,9.973122e-01,9.980001e-01,9.973230e-01,9.971575e-01, 9.989827e-01,9.996971e-01,9.997231e-01,1.000292e+00,1.000085e+00, 1.001142e+00,1.001304e+00,1.001695e+00,1.001143e+00,1.002837e+00, 1.001940e+00,1.003536e+00,1.002942e+00,1.003327e+00,1.002561e+00, 1.003311e+00,1.002824e+00,1.003182e+00,1.003780e+00,1.004576e+00, 1.003021e+00,1.003986e+00,1.003222e+00,1.003681e+00,1.004197e+00, 1.004315e+00,1.004469e+00,1.003865e+00]

        HHsop = [0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00, 7.981407e-04,1.889192e-03,2.514477e-03,1.693581e-02,2.851383e-02, 5.068008e-02,9.286652e-02,1.648467e-01,3.301807e-01,4.479623e-01, 6.781664e-01,9.252295e-01,1.159585e+00,1.409067e+00,1.584558e+00, 1.706037e+00,1.634921e+00,1.548669e+00,1.345122e+00,1.092116e+00, 9.330298e-01,6.334869e-01,4.529241e-01,3.280065e-01,2.472807e-01, 2.085880e-01,2.201703e-01,2.514645e-01,3.044227e-01,3.750437e-01, 4.555026e-01,5.427595e-01,6.385142e-01,7.397020e-01,8.342065e-01, 9.279909e-01,1.015242e+00,1.092877e+00,1.161151e+00,1.214594e+00, 1.247865e+00,1.271351e+00,1.283189e+00,1.279696e+00,1.267256e+00, 1.242645e+00,1.207583e+00,1.172200e+00,1.129881e+00,1.081853e+00, 1.036751e+00,9.939508e-01,9.514706e-01,9.136250e-01,8.771285e-01, 8.495263e-01,8.246217e-01,8.019246e-01,7.851200e-01,7.737301e-01, 7.656086e-01,7.633717e-01,7.620395e-01,7.648299e-01,7.699579e-01, 7.789172e-01,7.873493e-01,8.033755e-01,8.161374e-01,8.310729e-01, 8.454793e-01,8.616043e-01,8.788194e-01,8.944678e-01,9.138691e-01, 9.331530e-01,9.525682e-01,9.720349e-01,9.914312e-01,1.011106e+00, 1.033663e+00,1.051862e+00,1.068885e+00,1.087276e+00,1.099531e+00, 1.114141e+00,1.129576e+00,1.135759e+00,1.144634e+00,1.150828e+00, 1.157747e+00,1.155586e+00,1.158897e+00,1.152945e+00,1.150998e+00, 1.145716e+00,1.142248e+00,1.134502e+00,1.125847e+00,1.119012e+00, 1.108357e+00,1.105351e+00,1.096884e+00,1.087640e+00,1.079556e+00, 1.071357e+00,1.066195e+00,1.058291e+00,1.051914e+00,1.046170e+00, 1.041176e+00,1.031962e+00,1.028174e+00,1.024286e+00,1.019015e+00, 1.016230e+00,1.010538e+00,1.007342e+00,1.002941e+00,1.003077e+00, 9.989977e-01,9.954097e-01,9.920114e-01,9.883648e-01,9.855831e-01, 9.829490e-01,9.801706e-01,9.793651e-01,9.770788e-01,9.733227e-01, 9.733432e-01,9.718290e-01,9.707283e-01,9.699141e-01,9.676787e-01, 9.662928e-01,9.660853e-01,9.639637e-01,9.654065e-01,9.650747e-01, 9.646386e-01,9.634484e-01,9.649152e-01,9.657601e-01,9.667504e-01, 9.667353e-01,9.672562e-01,9.688439e-01,9.691828e-01,9.710162e-01, 9.726861e-01,9.731666e-01,9.742082e-01,9.754958e-01,9.770185e-01, 9.796776e-01,9.822837e-01,9.839363e-01,9.852458e-01,9.864866e-01, 9.899338e-01,9.889933e-01,9.911870e-01,9.921228e-01,9.944283e-01, 9.949228e-01,9.971981e-01,9.982036e-01,9.989999e-01,1.000175e+00, 1.002509e+00,1.002284e+00,1.003167e+00,1.004010e+00,1.003705e+00, 1.003464e+00,1.004942e+00,1.005648e+00,1.005137e+00,1.004891e+00, 1.005916e+00,1.004956e+00,1.005620e+00,1.005350e+00,1.005165e+00, 1.005605e+00,1.004741e+00,1.004653e+00,1.006355e+00,1.006037e+00, 1.007105e+00,1.004709e+00,1.004898e+00,1.006135e+00,1.005964e+00, 1.005155e+00,1.004881e+00,1.007188e+00,1.005505e+00,1.005911e+00, 1.006911e+00,1.007121e+00,1.007138e+00,1.007215e+00,1.007508e+00, 1.007437e+00,1.007402e+00,1.007012e+00,1.007215e+00,1.006490e+00, 1.007648e+00,1.006969e+00,1.008198e+00,1.007219e+00,1.007246e+00, 1.006923e+00,1.007049e+00,1.007120e+00,1.006981e+00,1.005439e+00, 1.005438e+00,1.005778e+00,1.005080e+00,1.005227e+00,1.003472e+00, 1.003834e+00,1.003557e+00,1.003671e+00,1.002562e+00,1.001701e+00, 1.002372e+00,1.001624e+00,9.995964e-01,9.993748e-01,1.000087e+00, 9.996907e-01,9.989421e-01,9.989805e-01,9.992790e-01,9.978603e-01, 9.974768e-01,9.983796e-01,9.967970e-01,9.964689e-01,9.963359e-01, 9.957316e-01,9.951026e-01,9.948213e-01,9.940643e-01,9.948575e-01, 9.948773e-01,9.933402e-01,9.948975e-01,9.945797e-01,9.952940e-01, 9.951187e-01,9.953706e-01,9.945024e-01,9.947240e-01,9.955921e-01, 9.960642e-01,9.951548e-01,9.950329e-01,9.959612e-01,9.955093e-01, 9.950137e-01,9.952316e-01,9.949526e-01,9.953540e-01,9.965636e-01, 9.962649e-01,9.962645e-01,9.960686e-01,9.968810e-01,9.979233e-01, 9.978176e-01,9.969769e-01,9.980593e-01,9.985923e-01,9.987082e-01, 9.994892e-01,9.997100e-01,1.000263e+00,1.000246e+00,1.001148e+00, 1.001381e+00,1.001701e+00,1.002780e+00,1.002989e+00,1.002479e+00, 1.003418e+00,1.003215e+00,1.003555e+00,1.003243e+00,1.002995e+00, 1.003102e+00,1.003838e+00,1.003227e+00]
        
    return rsop, OOsop, OHsop, HHsop

def read_data( filename ):

    # read volumen and energy results 
    data = np.loadtxt(filename, skiprows=0)    

    return data[:,0], data[:,1]

def rdf(par):
    
    rsop, sopOO, sopOH, sopHH = Soper(par)

    # Leitura dos arquivos a serem comparados

    rpbe, pbeOO = read_data('rdf.O-O.dat')
    rpbe, pbeOH = read_data('rdf.O-H.dat')
    rpbe, pbeHH = read_data('rdf.H-H.dat')

    cm=1/2.54

    plt.rcParams.update({'text.usetex': True})
    plt.rcParams['text.latex.preamble'] = [
       r'\usepackage{helvet}',    # set the normal font here
       r'\usepackage{sansmath}',  # load up the sansmath so that math -> helvet
       r'\sansmath'               # <- tricky! -- gotta actually tell tex to use!
]

    fig, ax = plt.subplots(3, 1, figsize=(8*cm, 12*cm), sharex=True)

    if 'label' in par:
        text = par['label']

    else:
        text = 'Theoretical'

    ax[0].plot(rsop, sopOO, '--', linewidth=1.3, color='gray', label='Soper')
    ax[0].plot(rpbe, pbeOO, linewidth=1.3, color='#2390cf', label=text)

    ax[1].plot(rsop, sopOH, '--', linewidth=1.3, color='gray', label='Soper')
    ax[1].plot(rpbe, pbeOH, linewidth=1.3, color='#2390cf', label=text)

    ax[2].plot(rsop, sopHH, '--', linewidth=1.3, color='gray', label='Soper')
    ax[2].plot(rpbe, pbeHH, linewidth=1.3, color='#2390cf', label=text)

    axins = inset_axes(ax[0], width="30%",  height="30%", loc='upper right')
    axins.plot(rsop, sopOO, '--', linewidth=1.3, color='gray', label='Soper')
    axins.plot(rpbe, pbeOO, linewidth=1.3, color='#2390cf', label=text)

    axins2 = inset_axes(ax[1], width="30%",  height="30%", loc='upper right')
    axins2.plot(rsop, sopOH, '--', linewidth=1.3, color='gray', label='Soper')
    axins2.plot(rpbe, pbeOH, linewidth=1.3, color='#2390cf', label=text)

    ax[0].legend(loc=2, fontsize=6)
    ax[0].set_xlim(0, 7.)
    ax[0].set_ylim(0, 6)

    ax[0].set_ylabel(r'$\rm{g_{OO}}$', fontsize=10)

    ax[1].set_xlim(0, 7.)
    ax[1].set_ylim(0, 6)

    ax[1].set_ylabel(r'$\rm{g_{OH}}$', fontsize=10)

    ax[2].set_xlim(0, 7.)
    ax[2].set_ylim(0, 3)

    ax[2].set_xlabel(r'$\rm{r [\AA]}$', fontsize=10)
    ax[2].set_ylabel(r'$\rm{g_{HH}}$', fontsize=10)


    ax[2].set_xticks([0,1,2,3,4,5,6,7])
    ax[2].set_xticklabels([0,1,2,3,4,5,6,7])

    x1, x2, y1, y2 = 2.5, 3.0, 2.0, 6.0
    axins.set_xlim(x1, x2)
    axins.set_ylim(y1, y2)

    x1, x2, y1, y2 = 0.8, 1.2, 0.0, 20
    axins2.set_xlim(x1, x2)

    if 'classical' in par:
        y2 = 50

    axins2.set_ylim(y1, y2)

    ax[0].tick_params(length=3, width=0.5, direction='in')
    ax[1].tick_params(length=3, width=0.5, direction='in')
    ax[2].tick_params(length=3, width=0.5, direction='in')
    axins.tick_params(length=3, width=0.5, direction='in')
    axins2.tick_params(length=3, width=0.5, direction='in')

    for tick in ax[0].xaxis.get_major_ticks():
        tick.label.set_fontsize(10)

    for tick in ax[0].yaxis.get_major_ticks():
        tick.label.set_fontsize(10)

    for tick in ax[1].xaxis.get_major_ticks():
        tick.label.set_fontsize(10)

    for tick in ax[1].yaxis.get_major_ticks():
        tick.label.set_fontsize(10)

    for tick in ax[2].xaxis.get_major_ticks():
        tick.label.set_fontsize(10)

    for tick in ax[2].yaxis.get_major_ticks():
        tick.label.set_fontsize(10)


    for tick in axins.xaxis.get_major_ticks():
        tick.label.set_fontsize(8)

    for tick in axins.yaxis.get_major_ticks():
        tick.label.set_fontsize(8)

    for tick in axins2.xaxis.get_major_ticks():
        tick.label.set_fontsize(8)

    for tick in axins2.yaxis.get_major_ticks():
        tick.label.set_fontsize(8)

def vmd(par):
    vmd_file = 'vmd-rdf.tcl'
    arquivo = open(vmd_file, 'w')

    first_line = 'mol load pdb '+str(par['input_file'])
    arquivo.write(first_line)
    arquivo.write(r'''

package require pbctools

set O [atomselect top "{name O}"]
set H [atomselect top "{name H}"]

set outfile [open rdf.O-O.dat w]
set gr0 [measure gofr $O $O delta 0.01 rmax 10.0 first 0 last -1 step 1 usepbc TRUE selupdate TRUE]

set r [lindex $gr0 0]
set gr [lindex $gr0 1]
set igr [lindex $gr0 2]
set isto [lindex $gr0 3]
foreach j $r k $gr l $igr m $isto {
    puts $outfile [format "%.4f\t%.4f\t%.4f\t%.4f" $j $k $l $m]
}
close $outfile

set outfile [open rdf.O-H.dat w]
set gr0 [measure gofr $O $H delta 0.01 rmax 10.0 first 0 last -1 step 1 usepbc TRUE selupdate TRUE]

set r [lindex $gr0 0]
set gr [lindex $gr0 1]
set igr [lindex $gr0 2]
set isto [lindex $gr0 3]
foreach j $r k $gr l $igr m $isto {
    puts $outfile [format "%.4f\t%.4f\t%.4f\t%.4f" $j $k $l $m]
}
close $outfile

set outfile [open rdf.H-H.dat w]
set gr0 [measure gofr $H $H delta 0.01 rmax 10.0 first 0 last -1 step 1 usepbc TRUE selupdate TRUE]

set r [lindex $gr0 0]
set gr [lindex $gr0 1]
set igr [lindex $gr0 2]
set isto [lindex $gr0 3]
foreach j $r k $gr l $igr m $isto {
    puts $outfile [format "%.4f\t%.4f\t%.4f\t%.4f" $j $k $l $m]
}
close $outfile

exit
    ''')


def show_help():
    print ('''
ipi2rdf is a script to calculate and plot the theoretical and experimental g(r) for water (T=298K and rho=1.0g/cm^3) and ice (T=220K and rho=0.917g/cm^3). The experimental data is taken from Soper et al, Chem. Phys. Special Issue 258(2000)121

Usage: ipi2rdf [OPTIONS]

INSTALATION:
    For install this code, type: 'python ipi2rdf.py -i'

OPTIONS:
    
    -f or --file (pdb file)
        sets pdb file to calculate the theoretical g(r).

    -g or --geometry (ice or water)
        sets the geometry to compare the g(r) with experimental data.

    -l or --label (label name) (default: Theoretical)
        sets the label name of theoretical g(r).

    -sf or --save_file
        the rdf output file is saved if this option is marked.

    -cl or --classical (default: False)
        sets the maximum range of y-axis O-H inset. 

    -o or --output (.png file)
        sets the output file to save the graph.

    -h or --help
        displays this help menu

AUTHOR
   Lucas Thiago Siqueira de Miranda
''')

def param_select():
    par={}
    for i,v in enumerate(sys.argv):
        if v[0] == '-':
            try:
                next_arg=sys.argv[i+1]
            except:
                next_arg=sys.argv[i]
            if v in ('-f','--file'):
                par['input_file'] = next_arg
            
            elif v in ('-g','--geometry'):
                par['geometry'] = next_arg

            elif v in ('-l', '--label'):
                par['label'] = next_arg

            elif v in ('-sf', '--save_file'):
                par['save_file'] = True

            elif v in ('-o', '--output'):
                par['output_file'] = next_arg

            elif v in ('-cl', '--classical'):
                par['classical'] = True

            elif v in ('-h','--help'):
                show_help()
                exit()

    return par

# Instalation
if ('-i' in sys.argv or '--install' in sys.argv ) and '.py' in sys.argv[0]:
    print('Installing...')
    exe=sys.argv[0].replace('.py','')
    os.system('which python > .tmp')
    program='#!'+open('.tmp','r').read()
    program+=open(sys.argv[0],'r').read()[1:]
    open(exe,'w').write(program)
    os.system('rm .tmp')
    os.system('chmod +x '+exe)
    print('Done!')
    exit()


# to be executed when called as a script
if __name__ == "__main__":
    
    # parse filename argument
    par=param_select()
    
    #if not 'input_file' or 'geometry' in par:
    #    print("Missing some option, please read the help menu")
    #    show_help()
    #    exit()

    if "input_file" in par:
        vmd(par) 
        os.system('vmd -e vmd-rdf.tcl -dispdev text')
    
    rdf(par)
    plt.tight_layout()
    plt.draw()

    if 'output_file' in par:
        plt.savefig(par['output_file'], dpi=500, bbox_inches='tight')
    else:
        plt.show()

    if 'save_file' in par:
        sys.exit()

    os.system('rm rdf.O-O.dat rdf.O-H.dat rdf.H-H.dat vmd-rdf.tcl')
    sys.exit()
